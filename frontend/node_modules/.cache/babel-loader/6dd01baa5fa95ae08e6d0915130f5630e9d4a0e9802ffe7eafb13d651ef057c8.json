{"ast":null,"code":"import { addCard, changeCard } from \"../../../entities/card\";\nimport { addCardTag, removeCardTag } from \"../../../entities/cardTag\";\nimport { addTagToCard, createCard, removeTagFromCard, updateCard } from \"../../../shared/api\";\nexport const saveCard = async (dispatch, form, mode, item) => {\n  const isEdit = mode === \"edit\";\n  let savedCard;\n  if (isEdit && item !== null && item !== void 0 && item.id) {\n    var _form$term, _form$meaning, _form$example_sentenc, _item$level, _item$selectedTagIds;\n    savedCard = await updateCard(item.id, {\n      id: item.id,\n      term: (_form$term = form.term) !== null && _form$term !== void 0 ? _form$term : \"\",\n      meaning: (_form$meaning = form.meaning) !== null && _form$meaning !== void 0 ? _form$meaning : \"\",\n      example_sentence: (_form$example_sentenc = form.example_sentence) !== null && _form$example_sentenc !== void 0 ? _form$example_sentenc : \"\",\n      level: (_item$level = item.level) !== null && _item$level !== void 0 ? _item$level : 0\n    });\n    dispatch(changeCard(savedCard));\n    const oldIds = (_item$selectedTagIds = item.selectedTagIds) !== null && _item$selectedTagIds !== void 0 ? _item$selectedTagIds : [];\n    const newIds = form.selectedTagIds;\n    const toRemove = oldIds.filter(id => !newIds.includes(id));\n    for (const tagId of toRemove) {\n      await removeTagFromCard(savedCard.id, tagId);\n      dispatch(removeCardTag({\n        cardId: savedCard.id,\n        tagId\n      }));\n    }\n    const toAdd = newIds.filter(id => !oldIds.includes(id));\n    for (const tagId of toAdd) {\n      const data = await addTagToCard(savedCard.id, tagId);\n      dispatch(addCardTag({\n        id: data.id,\n        cardId: savedCard.id,\n        tagId\n      }));\n    }\n  } else {\n    var _form$term2, _form$meaning2, _form$example_sentenc2;\n    savedCard = await createCard((_form$term2 = form.term) !== null && _form$term2 !== void 0 ? _form$term2 : \"\", (_form$meaning2 = form.meaning) !== null && _form$meaning2 !== void 0 ? _form$meaning2 : \"\", (_form$example_sentenc2 = form.example_sentence) !== null && _form$example_sentenc2 !== void 0 ? _form$example_sentenc2 : \"\");\n    dispatch(addCard(savedCard));\n    for (const tagId of form.selectedTagIds) {\n      const data = await addTagToCard(savedCard.id, tagId);\n      dispatch(addCardTag({\n        id: data.id,\n        cardId: savedCard.id,\n        tagId\n      }));\n    }\n  }\n  return savedCard;\n};","map":{"version":3,"names":["addCard","changeCard","addCardTag","removeCardTag","addTagToCard","createCard","removeTagFromCard","updateCard","saveCard","dispatch","form","mode","item","isEdit","savedCard","id","_form$term","_form$meaning","_form$example_sentenc","_item$level","_item$selectedTagIds","term","meaning","example_sentence","level","oldIds","selectedTagIds","newIds","toRemove","filter","includes","tagId","cardId","toAdd","data","_form$term2","_form$meaning2","_form$example_sentenc2"],"sources":["D:/base/GitHub/MemoryCard/frontend/src/features/cardManager/model/services.ts"],"sourcesContent":["import { Dispatch } from \"react\";\r\nimport { UnknownAction } from \"@reduxjs/toolkit\";\r\nimport { addCard, changeCard } from \"../../../entities/card\";\r\nimport { addCardTag, removeCardTag } from \"../../../entities/cardTag\";\r\nimport { CardForm } from \"./useCardManager\";\r\nimport {addTagToCard, createCard, removeTagFromCard, updateCard} from \"../../../shared/api\";\r\nimport {ManagerMode} from \"../../../shared/types\";\r\n\r\nexport const saveCard = async (\r\n    dispatch: Dispatch<UnknownAction>,\r\n    form: CardForm,\r\n    mode: ManagerMode,\r\n    item?: CardForm\r\n) => {\r\n    const isEdit = mode === \"edit\";\r\n    let savedCard;\r\n\r\n    if (isEdit && item?.id) {\r\n        savedCard = await updateCard(item.id, {\r\n            id: item.id,\r\n            term: form.term ?? \"\",\r\n            meaning: form.meaning ?? \"\",\r\n            example_sentence: form.example_sentence ?? \"\",\r\n            level: item.level ?? 0,\r\n        });\r\n\r\n        dispatch(changeCard(savedCard));\r\n\r\n        const oldIds = item.selectedTagIds ?? [];\r\n        const newIds = form.selectedTagIds;\r\n\r\n        const toRemove = oldIds.filter(id => !newIds.includes(id));\r\n        for (const tagId of toRemove) {\r\n            await removeTagFromCard(savedCard.id, tagId);\r\n            dispatch(removeCardTag({ cardId: savedCard.id, tagId }));\r\n        }\r\n\r\n        const toAdd = newIds.filter(id => !oldIds.includes(id));\r\n        for (const tagId of toAdd) {\r\n            const data = await addTagToCard(savedCard.id, tagId);\r\n            dispatch(addCardTag({\r\n                id: data.id,\r\n                cardId: savedCard.id,\r\n                tagId,\r\n            }));\r\n        }\r\n\r\n    } else {\r\n        savedCard = await createCard(\r\n            form.term ?? \"\",\r\n            form.meaning ?? \"\",\r\n            form.example_sentence ?? \"\"\r\n        );\r\n\r\n        dispatch(addCard(savedCard));\r\n\r\n        for (const tagId of form.selectedTagIds) {\r\n            const data = await addTagToCard(savedCard.id, tagId);\r\n            dispatch(addCardTag({\r\n                id: data.id,\r\n                cardId: savedCard.id,\r\n                tagId,\r\n            }));\r\n        }\r\n    }\r\n\r\n    return savedCard;\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}