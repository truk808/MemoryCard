{"ast":null,"code":"import { addGroup, changeGroup } from \"../../../entities/group\";\nimport { addGroupModule, removeGroupModule } from \"../../../entities/groupModule\";\nimport { addModuleToGroup, createGroup, removeModuleFromGroup, updateGroup } from \"../../../shared/api\";\nexport const saveGroup = async (dispatch, form, mode, item) => {\n  const isEdit = mode === \"edit\";\n  let savedGroup;\n  if (isEdit && item !== null && item !== void 0 && item.id) {\n    var _form$name, _form$description, _item$selectedModuleI;\n    const formData = new FormData();\n    formData.append('name', (_form$name = form.name) !== null && _form$name !== void 0 ? _form$name : '');\n    formData.append('description', (_form$description = form.description) !== null && _form$description !== void 0 ? _form$description : '');\n    if (form.img) formData.append('img', form.img);\n    savedGroup = await updateGroup(item.id, formData);\n    dispatch(changeGroup(savedGroup));\n    const oldIds = (_item$selectedModuleI = item.selectedModuleIds) !== null && _item$selectedModuleI !== void 0 ? _item$selectedModuleI : [];\n    const newIds = form.selectedModuleIds;\n    const toRemove = oldIds.filter(id => !newIds.includes(id));\n    for (const moduleId of toRemove) {\n      await removeModuleFromGroup(savedGroup.id, moduleId);\n      dispatch(removeGroupModule({\n        groupId: savedGroup.id,\n        moduleId: moduleId\n      }));\n    }\n    const toAdd = newIds.filter(id => !oldIds.includes(id));\n    for (const moduleId of toAdd) {\n      const data = await addModuleToGroup(savedGroup.id, moduleId);\n      dispatch(addGroupModule({\n        id: data.id,\n        groupId: savedGroup.id,\n        moduleId: moduleId\n      }));\n    }\n  } else {\n    var _form$name2, _form$description2;\n    const formData = new FormData();\n    formData.append('name', (_form$name2 = form.name) !== null && _form$name2 !== void 0 ? _form$name2 : '');\n    formData.append('description', (_form$description2 = form.description) !== null && _form$description2 !== void 0 ? _form$description2 : '');\n    if (form.img) formData.append('img', form.img);\n    savedGroup = await createGroup(formData);\n    dispatch(addGroup(savedGroup));\n    for (const moduleId of form.selectedModuleIds) {\n      const data = await addModuleToGroup(savedGroup.id, moduleId);\n      dispatch(addGroupModule({\n        id: data.id,\n        groupId: savedGroup.id,\n        moduleId: moduleId\n      }));\n    }\n  }\n};","map":{"version":3,"names":["addGroup","changeGroup","addGroupModule","removeGroupModule","addModuleToGroup","createGroup","removeModuleFromGroup","updateGroup","saveGroup","dispatch","form","mode","item","isEdit","savedGroup","id","_form$name","_form$description","_item$selectedModuleI","formData","FormData","append","name","description","img","oldIds","selectedModuleIds","newIds","toRemove","filter","includes","moduleId","groupId","toAdd","data","_form$name2","_form$description2"],"sources":["D:/base/GitHub/MemoryCard/frontend/src/features/groupManager/model/services.ts"],"sourcesContent":["import {addGroup, changeGroup} from \"../../../entities/group\";\r\nimport {addGroupModule, removeGroupModule} from \"../../../entities/groupModule\";\r\nimport {AppDispatch} from \"../../../app/store\";\r\nimport {GroupForm} from \"./useGroupManager\";\r\nimport {ManagerMode} from \"../../../shared/types\";\r\nimport {addModuleToGroup, createGroup, removeModuleFromGroup, updateGroup} from \"../../../shared/api\";\r\n\r\nexport const saveGroup = async (\r\n    dispatch: AppDispatch,\r\n    form: GroupForm,\r\n    mode: ManagerMode,\r\n    item?: GroupForm\r\n) => {\r\n    const isEdit = mode === \"edit\";\r\n    let savedGroup;\r\n\r\n    if (isEdit && item?.id) {\r\n        const formData = new FormData();\r\n        formData.append('name', form.name ?? '');\r\n        formData.append('description', form.description ?? '');\r\n        if (form.img) formData.append('img', form.img);\r\n\r\n        savedGroup = await updateGroup(item.id, formData);\r\n\r\n        dispatch(changeGroup(savedGroup));\r\n\r\n        const oldIds = item.selectedModuleIds ?? [];\r\n        const newIds = form.selectedModuleIds;\r\n\r\n        const toRemove = oldIds.filter(id => !newIds.includes(id));\r\n        for (const moduleId of toRemove) {\r\n            await removeModuleFromGroup(savedGroup.id, moduleId);\r\n            dispatch(\r\n                removeGroupModule({\r\n                    groupId: savedGroup.id,\r\n                    moduleId: moduleId,\r\n                }));\r\n        }\r\n\r\n        const toAdd = newIds.filter(id => !oldIds.includes(id));\r\n        for (const moduleId of toAdd) {\r\n            const data = await addModuleToGroup(savedGroup.id, moduleId);\r\n            dispatch(addGroupModule({\r\n                id: data.id,\r\n                groupId: savedGroup.id,\r\n                moduleId: moduleId,\r\n            }));\r\n        }\r\n\r\n    } else {\r\n        const formData = new FormData();\r\n        formData.append('name', form.name ?? '');\r\n        formData.append('description', form.description ?? '');\r\n        if (form.img) formData.append('img', form.img);\r\n\r\n        savedGroup = await createGroup(formData);\r\n        dispatch(addGroup(savedGroup));\r\n\r\n        for (const moduleId of form.selectedModuleIds) {\r\n            const data = await addModuleToGroup(savedGroup.id, moduleId);\r\n            dispatch(addGroupModule({\r\n                id: data.id,\r\n                groupId: savedGroup.id,\r\n                moduleId: moduleId,\r\n            }));\r\n        }\r\n    }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}