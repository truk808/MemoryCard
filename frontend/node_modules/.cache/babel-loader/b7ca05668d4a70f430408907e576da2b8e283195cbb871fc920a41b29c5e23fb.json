{"ast":null,"code":"import { addModule, changeModule } from \"../../../entities/module\";\nimport { addModuleCard, removeModuleCard } from \"../../../entities/moduleCard\";\nimport { addCardToModule, createModule, removeCardFromModule, updateModule } from \"../../../shared/api\";\nexport const saveModule = async (dispatch, form, mode, item) => {\n  const isEdit = mode === \"edit\";\n  let savedModule;\n  if (isEdit && item !== null && item !== void 0 && item.id) {\n    var _item$selectedCardIds;\n    savedModule = await updateModule(item.id, form);\n    dispatch(changeModule(savedModule));\n    const oldIds = (_item$selectedCardIds = item === null || item === void 0 ? void 0 : item.selectedCardIds) !== null && _item$selectedCardIds !== void 0 ? _item$selectedCardIds : [];\n    const newIds = form.selectedCardIds;\n    const toRemove = oldIds.filter(id => !newIds.includes(id));\n    for (const cardId of toRemove) {\n      await removeCardFromModule(savedModule.id, cardId);\n      dispatch(removeModuleCard({\n        moduleId: savedModule.id,\n        cardId: cardId\n      }));\n    }\n    const toAdd = newIds.filter(id => !oldIds.includes(id));\n    for (const cardId of toAdd) {\n      const data = await addCardToModule(savedModule.id, cardId);\n      dispatch(addModuleCard({\n        id: data.id,\n        moduleId: savedModule.id,\n        cardId: cardId\n      }));\n    }\n  } else {\n    var _form$name, _form$icon;\n    savedModule = await createModule((_form$name = form.name) !== null && _form$name !== void 0 ? _form$name : \"\", (_form$icon = form.icon) !== null && _form$icon !== void 0 ? _form$icon : \"\");\n    dispatch(addModule(savedModule));\n    for (const cardId of form.selectedCardIds) {\n      const data = await addCardToModule(savedModule.id, cardId);\n      dispatch(addModuleCard({\n        id: data.id,\n        moduleId: savedModule.id,\n        cardId: cardId\n      }));\n    }\n  }\n};","map":{"version":3,"names":["addModule","changeModule","addModuleCard","removeModuleCard","addCardToModule","createModule","removeCardFromModule","updateModule","saveModule","dispatch","form","mode","item","isEdit","savedModule","id","_item$selectedCardIds","oldIds","selectedCardIds","newIds","toRemove","filter","includes","cardId","moduleId","toAdd","data","_form$name","_form$icon","name","icon"],"sources":["D:/base/GitHub/MemoryCard/frontend/src/features/moduleManager/model/services.ts"],"sourcesContent":["import { addModule, changeModule } from \"../../../entities/module\";\r\nimport { addModuleCard, removeModuleCard } from \"../../../entities/moduleCard\";\r\nimport { AppDispatch } from \"../../../app/store\";\r\nimport { ModuleForm } from \"./useModuleManager\";\r\nimport {ManagerMode} from \"../../../shared/types\";\r\nimport {addCardToModule, createModule, removeCardFromModule, updateModule} from \"../../../shared/api\";\r\n\r\nexport const saveModule = async (\r\n    dispatch: AppDispatch,\r\n    form: ModuleForm,\r\n    mode: ManagerMode,\r\n    item?: ModuleForm\r\n) => {\r\n    const isEdit = mode === \"edit\";\r\n    let savedModule;\r\n\r\n    if (isEdit && item?.id) {\r\n        savedModule = await updateModule(item.id, form);\r\n        dispatch(changeModule(savedModule));\r\n\r\n        const oldIds = item?.selectedCardIds ?? [];\r\n        const newIds = form.selectedCardIds;\r\n\r\n        const toRemove = oldIds.filter(id => !newIds.includes(id));\r\n        for (const cardId of toRemove) {\r\n            await removeCardFromModule(savedModule.id, cardId);\r\n            dispatch(\r\n                removeModuleCard({\r\n                    moduleId: savedModule.id,\r\n                    cardId: cardId,\r\n                })\r\n            );\r\n        }\r\n\r\n        const toAdd = newIds.filter(id => !oldIds.includes(id));\r\n        for (const cardId of toAdd) {\r\n            const data = await addCardToModule(savedModule.id, cardId);\r\n            dispatch(\r\n                addModuleCard({\r\n                    id: data.id,\r\n                    moduleId: savedModule.id,\r\n                    cardId: cardId,\r\n                })\r\n            );\r\n        }\r\n\r\n    } else {\r\n        savedModule = await createModule(form.name ?? \"\", form.icon ?? \"\");\r\n        dispatch(addModule(savedModule));\r\n\r\n        for (const cardId of form.selectedCardIds) {\r\n            const data = await addCardToModule(savedModule.id, cardId);\r\n            dispatch(\r\n                addModuleCard({\r\n                    id: data.id,\r\n                    moduleId: savedModule.id,\r\n                    cardId: cardId,\r\n                })\r\n            );\r\n        }\r\n    }\r\n};\r\n"],"mappings":"AAAA,SAASA,SAAS,EAAEC,YAAY,QAAQ,0BAA0B;AAClE,SAASC,aAAa,EAAEC,gBAAgB,QAAQ,8BAA8B;AAI9E,SAAQC,eAAe,EAAEC,YAAY,EAAEC,oBAAoB,EAAEC,YAAY,QAAO,qBAAqB;AAErG,OAAO,MAAMC,UAAU,GAAG,MAAAA,CACtBC,QAAqB,EACrBC,IAAgB,EAChBC,IAAiB,EACjBC,IAAiB,KAChB;EACD,MAAMC,MAAM,GAAGF,IAAI,KAAK,MAAM;EAC9B,IAAIG,WAAW;EAEf,IAAID,MAAM,IAAID,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAEG,EAAE,EAAE;IAAA,IAAAC,qBAAA;IACpBF,WAAW,GAAG,MAAMP,YAAY,CAACK,IAAI,CAACG,EAAE,EAAEL,IAAI,CAAC;IAC/CD,QAAQ,CAACR,YAAY,CAACa,WAAW,CAAC,CAAC;IAEnC,MAAMG,MAAM,IAAAD,qBAAA,GAAGJ,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEM,eAAe,cAAAF,qBAAA,cAAAA,qBAAA,GAAI,EAAE;IAC1C,MAAMG,MAAM,GAAGT,IAAI,CAACQ,eAAe;IAEnC,MAAME,QAAQ,GAAGH,MAAM,CAACI,MAAM,CAACN,EAAE,IAAI,CAACI,MAAM,CAACG,QAAQ,CAACP,EAAE,CAAC,CAAC;IAC1D,KAAK,MAAMQ,MAAM,IAAIH,QAAQ,EAAE;MAC3B,MAAMd,oBAAoB,CAACQ,WAAW,CAACC,EAAE,EAAEQ,MAAM,CAAC;MAClDd,QAAQ,CACJN,gBAAgB,CAAC;QACbqB,QAAQ,EAAEV,WAAW,CAACC,EAAE;QACxBQ,MAAM,EAAEA;MACZ,CAAC,CACL,CAAC;IACL;IAEA,MAAME,KAAK,GAAGN,MAAM,CAACE,MAAM,CAACN,EAAE,IAAI,CAACE,MAAM,CAACK,QAAQ,CAACP,EAAE,CAAC,CAAC;IACvD,KAAK,MAAMQ,MAAM,IAAIE,KAAK,EAAE;MACxB,MAAMC,IAAI,GAAG,MAAMtB,eAAe,CAACU,WAAW,CAACC,EAAE,EAAEQ,MAAM,CAAC;MAC1Dd,QAAQ,CACJP,aAAa,CAAC;QACVa,EAAE,EAAEW,IAAI,CAACX,EAAE;QACXS,QAAQ,EAAEV,WAAW,CAACC,EAAE;QACxBQ,MAAM,EAAEA;MACZ,CAAC,CACL,CAAC;IACL;EAEJ,CAAC,MAAM;IAAA,IAAAI,UAAA,EAAAC,UAAA;IACHd,WAAW,GAAG,MAAMT,YAAY,EAAAsB,UAAA,GAACjB,IAAI,CAACmB,IAAI,cAAAF,UAAA,cAAAA,UAAA,GAAI,EAAE,GAAAC,UAAA,GAAElB,IAAI,CAACoB,IAAI,cAAAF,UAAA,cAAAA,UAAA,GAAI,EAAE,CAAC;IAClEnB,QAAQ,CAACT,SAAS,CAACc,WAAW,CAAC,CAAC;IAEhC,KAAK,MAAMS,MAAM,IAAIb,IAAI,CAACQ,eAAe,EAAE;MACvC,MAAMQ,IAAI,GAAG,MAAMtB,eAAe,CAACU,WAAW,CAACC,EAAE,EAAEQ,MAAM,CAAC;MAC1Dd,QAAQ,CACJP,aAAa,CAAC;QACVa,EAAE,EAAEW,IAAI,CAACX,EAAE;QACXS,QAAQ,EAAEV,WAAW,CAACC,EAAE;QACxBQ,MAAM,EAAEA;MACZ,CAAC,CACL,CAAC;IACL;EACJ;AACJ,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}