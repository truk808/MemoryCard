{"ast":null,"code":"var _s = $RefreshSig$();\nimport React, { useEffect, useMemo } from \"react\";\nimport { useLocation } from \"react-router-dom\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { getRelatedIdsByEntityId } from \"../../../../shared/utils\";\nimport { getProgressByModule, getTrainingByModule } from \"../../../../shared/api\";\nimport { selectAllCardTags } from \"../../../../entities/cardTag\";\nimport { setProgress } from \"../../../../features/statistics\";\nimport { setSessions } from \"../../../../features/statistics\";\nimport { selectModuleById } from \"../../../../entities/module\";\nimport { selectCardsByTagId } from \"../../../../entities/card\";\nimport { selectAllTags } from \"../../../../entities/tag\";\n//переделать\nexport function useModuleSectionLogic() {\n  _s();\n  const [isOpenModuleManager, setIsOpenModuleManager] = React.useState(false);\n  const moduleId = +useLocation().pathname.split(\"/\")[2];\n  const module = useSelector(selectModuleById(moduleId))[0];\n  const moduleCard = useSelector(state => state.moduleCard.moduleCards);\n  const cardIds = getRelatedIdsByEntityId(moduleId, moduleCard, 'moduleId', 'cardId');\n  const termCards = useSelector(selectCardsByTagId(cardIds));\n  const tags = useSelector(selectAllTags);\n  const cardTags = useSelector(selectAllCardTags);\n  const cardsWithTags = termCards.map(card => {\n    const relatedTagIds = cardTags.filter(ct => ct.cardId === card.id).map(ct => ct.tagId);\n    const cardTagsList = tags.filter(tag => relatedTagIds.includes(tag.id));\n    return {\n      ...card,\n      tags: cardTagsList\n    };\n  });\n  const moduleInfo = useMemo(() => {\n    if (module) {\n      return {\n        id: module.id,\n        name: module.name,\n        selectedCardIds: cardIds\n      };\n    }\n  }, [module, cardIds]);\n\n  ////переделать\n  const dispatch = useDispatch();\n  useEffect(() => {\n    getProgressByModule([moduleId]).then(data => {\n      dispatch(setProgress(data));\n    });\n    getTrainingByModule(moduleId).then(data => {\n      dispatch(setSessions(data));\n    });\n  }, []);\n  return {\n    moduleId,\n    module,\n    moduleCard,\n    cardIds,\n    termCards,\n    tags,\n    cardsWithTags,\n    moduleInfo,\n    isOpenModuleManager,\n    setIsOpenModuleManager\n  };\n}\n_s(useModuleSectionLogic, \"u+Z2sbclJPKpMaGj5lWbMsbCKMw=\", false, function () {\n  return [useLocation, useSelector, useSelector, useSelector, useSelector, useSelector, useDispatch];\n});","map":{"version":3,"names":["React","useEffect","useMemo","useLocation","useDispatch","useSelector","getRelatedIdsByEntityId","getProgressByModule","getTrainingByModule","selectAllCardTags","setProgress","setSessions","selectModuleById","selectCardsByTagId","selectAllTags","useModuleSectionLogic","_s","isOpenModuleManager","setIsOpenModuleManager","useState","moduleId","pathname","split","module","moduleCard","state","moduleCards","cardIds","termCards","tags","cardTags","cardsWithTags","map","card","relatedTagIds","filter","ct","cardId","id","tagId","cardTagsList","tag","includes","moduleInfo","name","selectedCardIds","dispatch","then","data"],"sources":["D:/base/GitHub/MemoryCard/frontend/src/widgets/moduleSection/model/hooks/useModuleSectionLogic.ts"],"sourcesContent":["import React, {useEffect, useMemo} from \"react\";\r\nimport {useLocation} from \"react-router-dom\";\r\nimport {useDispatch, useSelector} from \"react-redux\";\r\nimport {RootState} from \"../../../../app/store\";\r\nimport {getRelatedIdsByEntityId} from \"../../../../shared/utils\";\r\nimport {getProgressByModule, getTrainingByModule} from \"../../../../shared/api\";\r\nimport {selectAllCardTags} from \"../../../../entities/cardTag\";\r\nimport {setProgress} from \"../../../../features/statistics\";\r\nimport {setSessions} from \"../../../../features/statistics\";\r\nimport {selectModuleById} from \"../../../../entities/module\";\r\nimport {selectCardsByTagId} from \"../../../../entities/card\";\r\nimport { selectAllTags } from \"../../../../entities/tag\";\r\nimport {CardWithTags} from \"../../../../shared/types/entityTypes\";\r\n\r\n//переделать\r\nexport function useModuleSectionLogic() {\r\n    const [isOpenModuleManager, setIsOpenModuleManager] = React.useState(false);\r\n\r\n    const moduleId = +useLocation().pathname.split(\"/\")[2];\r\n    const module = useSelector(selectModuleById(moduleId))[0];\r\n\r\n    const moduleCard = useSelector((state: RootState) => state.moduleCard.moduleCards);\r\n    const cardIds = getRelatedIdsByEntityId(moduleId, moduleCard, 'moduleId', 'cardId');\r\n    const termCards = useSelector(selectCardsByTagId(cardIds))\r\n\r\n    const tags = useSelector(selectAllTags);\r\n    const cardTags = useSelector(selectAllCardTags);\r\n\r\n    const cardsWithTags: CardWithTags[] = termCards.map((card) => {\r\n        const relatedTagIds = cardTags\r\n            .filter(ct => ct.cardId === card.id)\r\n            .map(ct => ct.tagId);\r\n\r\n        const cardTagsList = tags.filter(tag => relatedTagIds.includes(tag.id));\r\n\r\n        return {\r\n            ...card,\r\n            tags: cardTagsList,\r\n        };\r\n    });\r\n\r\n    const moduleInfo = useMemo(() => {\r\n        if (module) {\r\n            return {\r\n                id: module.id,\r\n                name: module.name,\r\n                selectedCardIds: cardIds,\r\n            };\r\n        }\r\n    }, [module, cardIds]);\r\n\r\n    ////переделать\r\n    const dispatch = useDispatch();\r\n\r\n    useEffect(() => {\r\n        getProgressByModule([moduleId]).then((data) => {\r\n            dispatch(setProgress(data))\r\n        })\r\n        getTrainingByModule(moduleId).then(data => {\r\n            dispatch(setSessions(data))\r\n        })\r\n    }, [])\r\n\r\n\r\n\r\n    return {\r\n        moduleId,\r\n        module,\r\n        moduleCard,\r\n        cardIds,\r\n        termCards,\r\n        tags,\r\n        cardsWithTags,\r\n        moduleInfo,\r\n        isOpenModuleManager,\r\n        setIsOpenModuleManager,\r\n    }\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}